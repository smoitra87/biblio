\documentclass[a4]{article}
\usepackage{graphicx}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{color}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}

\begin{document}

\title{Review Notes on DEE}

\author{Subhodeep Moitra \\ {\tt subhodee@andrew.cmu.edu}}

\maketitle

\begin{abstract}
To be added soon
\end{abstract}

\section{Introduction}
Some problems in computational structural biology such as sequence design or side chain rotamer optimization can be posed as discrete combinatorial optimization problems. These problems are more formally defined in the following section. Meanwhile, we will use the side chain optimization problem as a running example since the sequence design problem is conceptually the same.  In these problems we try to minimize an energy function parametrized by the discrete variable. The global minumum of the energy function is known as the GMEC (Global Minimum Energy Conformation). Finding the GMEC is NP-hard as shown by~\ref{Pierce}. This is a sobering result and efforts to find a polynomial time solution for these protein design problems is likely to be fruitless. Nevertheless, the nature of the rotamers or the sequences is such that some of these states are clearly wrong and can be safely ignored while searching for the GMEC. For e.g.(1) a rotameric position which causes clashes with the backbone can be safely ignored from consideration (2) a polar amino acid can be safely ignored from the hydrophobic core. This leads us to the Dead-End Elimination algorithm (DEE). 
\\
\\
The DEE algorithm has been used as a search space reduction technique for problems in computational structural biology. These problems involve an exponential number of possible solution candidates. The DEE algorithm is able to successfully prune the search space while retaining the GMEC. The basic idea  is to be able to find bad combinations of variables known as dead ends. This is in direct contrast to the Dynamic programming style of finding a solution, which involves keeping the best and most promising candidates. 
\\
\\
Every DEE algorithm essentially has the following components :
\begin{enumerate}
\item A well defined set of discrete independent variables
\item A \emph{precomputed} numerical value(considered the energy) associated with each element in the set of variables. You can even define these energies for their pairs, triples, etc
\item A criterion for determining when an element is a dead end
\item An objective function considered to be the energy function to be minimized
\end{enumerate}



The DEE algorithm has undergone a lot of change since it was first published~\ref{Desmet92} in 1992. Newer criteria for the pruning the search space emerged. Newer criteria are measured by their efficiency i.e. how quickly you can check criterion and the eliminating power i.e. how much of the space they can prune. Stronger criteria were added that were able to prune out more of the search space. A number of novel criteria and DEE models emerged that are able to do some non-traditional DEE tasks such as Backrub modeling, flexible backbone, continuous rotamers etc. The DEE algorithm is no magic bullet. Even though it is typically able to prune the search space of protein problems effectively, the exhaustive search to be performed afterwards can still be quite computationally demanding.

\subsection{Side chain placement problem}
The side chain placement problem(SCP) refers to finding the conformation of the side chains of the protein assuming a fixed backbone. The entire continuous space of the side chains is not modelled. They are usually discretized into a set of discrete rotamers~\ref{Dunbrack}. Every conformation has an associated energy. The energy function is decomposable into energy contributions from each of the individual amino acids or pairs of amino acids. This is reasonable since atoms in proteins are assumed to interact only by two body potentials. The energy of particular conformation represented by a vector $r$ is represented as : 
\[
E(r) = \sum_{i=1}^{N}E_i(r_i) + \sum_{i<j}E_{ij}(r_i,r_j)
\]

where $E(r)$ corresponds to the overall energy of a rotamer conformation space represented by the vector $r$. The rotamer for amino acid $i$ is represented by $r_i$. Also, $r_i^A$ corresponds to the rotamer at position $i$ taking state A. The rotamers for a particular amino acid are restricted to a discrete set $r_i \in \{1,2,\cdots,R_i\}$. $E_i(r_i)$ corresponds to the precomputed energies for rotamer for amino acid $i$ and the backbone. $E_{ij}(r_i,r_j)$ corresponds to the precomputed energies between the pair of rotamers for amino acid $i$ and $j$ respectively. 
Note that, $E_{kk}(r_k^A,r_k^A)$ that the pair energy between a rotamer and itself is taken to be zero. This simplifies description of the pairs criterion to be presented below. 
\\
\\
In principle one can make energy function arbitrarily complex taking contributions from tuples of amino acids. However the fact the function decomposes into atomic parts is what makes it possible to apply pruning techniques such as DEE.  The side chain placement problem is a discrete combinatorial optimization problem which involves finding the conformation $r^*$ which minimizes the function $E(r)$. This conformation $r^*$ is known as the global minimum energy conformation or the GMEC.
\[
\begin{split}
r^* &= \argmin_{r_i \in \{1,2,\cdots,R_i\}} E(r) \\
&= \argmin_{r_i \in \{1,2,\cdots,R_i\}} \sum_{i=1}^{N}E_i(r_i) + \sum_{i<j}E_{ij}(r_i,r_j)
\end{split}
\]
This problem has been recast into a number of different frameworks such as Integer programming, graph based methods, etc. Nevertheless, this problem has been shown to be NP-Hard~\ref{Pierce}. There are a number of methods that try to solve the problem with no guarantees for optimality using techniques such as simulated annealing, monte carlo optimization, etc.  The state of the art is the SCWRL4~\ref{SCWRL4} algorithm. SCWRL4's goal is performance rather than algorithmic novelty. So they use a number of different existing successful techniques in order to find a good placement. 
\\
\\
The DEE algorithm can be used in those algorithms that try to exactly find the GMEC. Basically, any algorithm that attempts to find the GMEC has to resort to exhaustive search unless there is some structure in the energy function. But most SCP problems do not have this kind of structure and can have exponential worst case behavior. DEE is used to prune the search space. The original DEE algorithm~\ref{Desmet92} used the singles and the doubles elimination criteria for pruning single and pairwise rotamer pairs. 


\subsection{Protein Design problem}
The protein design problem(PD) refers to finding an amino acid sequence that is compatible with a desired protein structure. The compatibility with the desired structure is measured through an energy function. The form of the energy function is much like the side chain placement problem. The optimization problem becomes a discrete combinatorial optimization problem. The optimization over the sequence space hides an inner optimization of the rotameric space
\[
\begin{split}
S^* &= \argmin_{S} E^*(S) \\
	&= \argmin_{S} \left( \min_{r} E(r) \right) \quad \text{s.t. $\tau(r)=S$} \\
	&= \argmin_{S} \left( \min_{r_i \in \{1,2,\cdots,R_i\}} \sum_{i=1}^{N}E_i(r_i) + \sum_{i<j}E_{ij}(r_i,r_j) \right) \quad \text{s.t. $\tau(r)=S$}
\end{split}
\]

Here, $E^*(S)$ corresponds to the minimum energy rotameric conformation given a particular sequence. $\tau(r)$ is a mapping from a rotamer space to a sequence. This has an implicit minimization which is the same as finding the GMEC for the SCP problem. The backbone is held fixed regardless of the amino acid sequence or the position of the rotamers. This is  ofcourse not a realistic assumption, but it is done so by design. The goal is to have a protein sequence which assumes the backbone shape, not just to find a stable structure. The PD problem can in fact be reformulated into the SCP problem by extending the rotameric space. The optimal sequence is then trivially retrieved by mapping the rotamers to their corresponding amino acids.
\[
\begin{split}
S^* &= \tau\left( \min_{r_i \in \{1,2,\cdots,R_{all}\}} \sum_{i=1}^{N}E_i(r_i) + \sum_{i<j}E_{ij}(r_i,r_j) \right)
\end{split}
\]
where $R_{all}$ corresponds to all the rotamers of all the amino acids. In practice, we do not need to search over all positions in the protein. We are most often interested in redesigning an active site or a binding site. We also don't need to search over the space of all the amino acids at a particular position. Knowledge about the hydrophobicity and/or evolutionary constraints can help restrict the search space apriori. 


The DEE algorithm can be used here again to significantly reduce the search space. A short zinc finger protein was redesigned using an early version of the DEE algorithm~\ref{Dahiyat1997}. 

\section{Original Criteria}
The original DEE algorithm~\ref{Desmet1992} proposed single as well as multi-residue rotamer criteria. They are as follows :

\subsection{Singles Elimination criterion}
The rotamer $r_i^A$ is a dead end if there exists another rotamer $r_i^B$ for amino acid $i$ and the following condition holds: 
\begin{equation}	
\label{Singles:criteria} 
E_i(r_i^A) + \sum_j \min_X E_{ij}(r_i^A,r_j^X) > E_i(r_i^B) + \sum_j \max_X E_{ij}(r_i^B,r_j^X) \quad   ; j\neq i
\end{equation}
This basically, says that if the best possible energy contribution by the rotamer $r_i^A$ is worse than the worst possible energy contribution by another rotamer $r_i^B$, letting the rotamers of other amino acids be anything, then $r_i^A$ is a dead-end and should be eliminated.
This criterion scales $O(r^2)$ where $r$ represents all the rotamers for all the amino acids in the protein. 

\subsection{Pairs Elimination criterion}
The pairs elimination criterion generalizes the singles elimination criterion by allowing the elimination of rotamer pairs. This can be extended to multi-residue combinations as well. To illustrate this criterion we will introduce the following notation. The self-energy of a pair of rotamers is described as : 
\[
\mathcal{E}(r_i^A,r_j^P) = E_i(r_i^A) + E_j(r_j^P) + E_{ij}(r_i^A,r_j^P)
\]
A rotamer pair $(r_i^A,r_j^P)$ is a dead-end if there exists another amino acid pair $(r_i^B,r_j^Q)$ such that the following condition holds:
\[
\begin{split}
\mathcal{E}(r_i^A,r_j^P) &+ \sum_k \min_X \left( E_{ik}(r_i^A,r_k^X) + E_{jk}(r_j^P,r_k^X) \right) > \\ & \mathcal{E}(r_i^B,r_j^Q) + \sum_k \max_X \left( E_{ik}(r_i^B,r_k^X) + E_{jk}(r_j^Q,r_k^X) \right) \\
& \text{where $k\neq j \neq i$}
\end{split}
\]
This criterion scales $O(r^3)$ where $r$ represents all the rotamers for all the amino acids in the protein. More generally, for multi-residue criteria of order $m$ it scales as $O(r^{m+1})$. 

\subsection{Proof of Singles DEE criterion}
The main idea behind the DEE criteria is local optimality. It means that at GMEC, each residue has a locally optimal assignment. i.e. it is not possible to substitute any other rotamer type for that residue given that the others are in GMEC. Now on to the proof.
\\
\\
The optimality of GMEC means that 
\begin{equation}
\label{Singles:opt}
E(r^*) \leq E(r) \quad \forall r
\end{equation}
Let us expand the energy function focusing on a rotamer $r_i^G$ in GMEC. $G$ represents a rotamer in GMEC.
\begin{equation}
\label{Singles:gmec}
E(r^*) = E_{bb} + E_i(r_i^G) + \sum_j E_{ij}(r_i^G,r_j^G) + \sum_j E_j(r_j^G) + \sum_{j<k} E_{jk}(or_j^G,r_k^G) \quad ; j,k\neq i
\end{equation}
Now, let us suppose that our residue of interest $r_i$ adopts a different rotameric conformation from  GMEC such as $r_i^T$. The energy is represented as :
\begin{equation}
\label{Singles:nongmec}
E(r) = E_{bb} + E_i(r_i^T) + \sum_j E_{ij}(r_i^T,r_j^G) + \sum_j E_j(r_j^G) + \sum_{j<k} E_{jk}(or_j^G,r_k^G) \quad ; j,k\neq i
\end{equation}
Applying the GMEC optimality criteria from equation~\ref{Singles:opt} and combining equations \ref{Singles:gmec} and \ref{Singles:nongmec}, we get the \emph{local optimality criterion}. 
\begin{align*}
E_i(r_i^G) + \sum_j E_{ij}(r_i^G,r_j^G) \leq E_i(r_i^T) + \sum_j E_{ij}(r_i^T,r_j^G)  \quad   
; j\neq i 
\end{align*}



Taking mins and maxs on the LHS and RHS still preserves the inequality. We get, 
\begin{equation}
E_i(r_i^G) + \sum_j \min_X E_{ij}(r_i^G,r_j^X) \leq E_i(r_i^T) + \sum_j \max_X E_{ij}(r_i^T,r_j^X)  \quad   
; j\neq i 
\end{equation}


\textbf{Proof By Contradiction:}
\\
Let us assume that a particular rotameric conformation $r_i^T$ is in GMEC and that it satisfies the singles criterion from equation~\ref{Singles:criteria}. 
\[
E_i(r_i^T) + \sum_j \min_X E_{ij}(r_i^T,r_j^X) > E_i(r_i^G) + \sum_j \max_X E_{ij}(r_i^G,r_j^X) \quad   
; j\neq i
\]
But we have also stated that $r_i^T$ is in GMEC. So,
\[
E_i(r_i^T) + \sum_j \min_X E_{ij}(r_i^T,r_j^X) \leq E_i(r_i^G) + \sum_j \max_X E_{ij}(r_i^G,r_j^X) \quad   
; j\neq i
\]
We arrive at a contradiction and hence  $r_i^T$ cannot be in GMEC. 

\section{Goldstein Criteria}

\section{Split DEE}

\section{Gordon Criteria}

\section{DEE for Protein Design- Mayo}

\section{DEE for Multistate protein design}
A subproblem in the 

\section{DEE for Flexible backbone}

\section{minDEE}

\section{Restricted DEE}

\section{iminDEE - Continuous rotamers}

\section{Backrub}

\section{BroMAP}

\section{DEEPer}

\section{Connections}
\subsection{Graphical models and Max Product BP}

\subsection{Dynamic Programming}


\section{Implementation}
Calculation  of $E_i(r_i)$ and $E_{ij}(r_i,r_j)$ can be quite expensive and is usually the major cost while applying the DEE procedure. However they scale linearly and quadratically with respect to rotamer size respectively, but just with large constants. 

First the method checks all rotamers for every amino acid and flags them. Then it checks rotamer pairs. This process iterates until no more rotamers or pairs can be eliminated. 

In practice, the number of rotamers can be reduced significantly by applying some screening rules. Pre-screening rotamers that cause clashes and have energy more than 30kcal/mol with backbone and surrounding side chains can be eliminated. Desmet et.al~\ref{Desmet1992} report  that they were able to achieve 44\% and 6\% of the rotamers in their experiment were eliminated based on backbone and side chain clashes thresholding respectively. This meant a reduction of the search space from $2.7\times10^{76}$ to $6.2\times10^{53}$ rotamer conformations. This is quite a large saving. After six iterations of DEE the solution space was reduced to $10,800$. They could easily brute force this. 


\subsection{Space requirements}
The space needed to store the energy values can be a limiting factor for large sequences. Let $N$ be the number of amino acids in the protein and $R$ be the number of rotamers per amino acid. Then we need $O(NR)$ space for unit energy values and $O(N^2R^2)$ for the pairwise energy values. 

\section{Discussion}

Problems with DEE :
\begin{itemize}
\item Is it worth trying to find the GMEC given that energy functions are not that accurate in the first place?
\item Is DEE a dual of Dynamic programming ? 
\item How are the energies pre-computed ? What is the conmplexity of doing this ?
\item How do the space requirements compare with the time requirements ?
\item How does the algo scale with size of the system ? Are some large systems impossible to model using this method ? 
\item How does DEE compare with other non-DEE techniques such as Monte Carlo, etc..
\item When calculating $E(r)$ the energy of the whole protein are all pairs of energies evaluated or is some sort of distance constraint enforced ?
\item Should you use bbdep rotamers or bbindep rotamers ?
\item What is the connection between local optimality of GMEC to graphical models and max product
\end{itemize}




\pagebreak
\newpage

\appendix


\section{Datasets used}


\begin{center}
    \begin{tabular}{ | l | l | p{8cm} |}
    \hline
    Paper & Dataset & Summary \\ \hline
    Desmet1992~\ref{Desmet1992} & Insulin, haemocyanin & Compared agreement with pdb for Insulin. Predicted on blind study of haemocyanin \\ \hline
    Tuesday & 9C & Cloudy with rain, across many northern regions. Clear spells
    across most of Scotland and Northern Ireland,
    but rain reaching the far northwest. \\ 
    \hline
    \end{tabular}
\end{center}

\section{Single State DEE}
The First DEE algorithm~\cite{Desmet1992} was used to prune out the search space by using the following criterion. 

Eliminate $r_i^k$, rotamer k at position i if the following condition holds
\[
E_i(r_i^k) + \sum_j \min_s E_{ij}(r_i^k,r_j^s) > E_i(r_i^l) + \sum_j \max_s E_{ij}(r_i^l,r_j^s)
\]


\section{Goldstein criteria}
This is a stronger condition than the single state DEE criteria.
Eliminate $r_i^k$, rotamer k at position i if the following condition holds
\[
E_i(r_i^k) - E_i(r_i^l) + \sum_j \min_s \left(E_{ij}(r_i^k,r_j^s) - E_{ij}(r_i^l,r_j^s) \right)> 0  
\]

Basically, this condition says that the energy function can be lowered by changing $r_i^k$ to $r_i^l$ while keeping all the non $r_i$ rotamers fixed. 


\section{Split DEE}
What happens when you cannot prune some rotamers away by using these criteria. Then you cluster rotamers into groups and then try to prune rotamers in these groups. This however causes a large increase in computation time, since computation is exponential in the number of subgroups. Why ?

\section{Multistate DEE}
DEE solves a discrete combinatorial optimization problem. The main contribution of the DEE algorithm is that it reduces the search space by provably pruning out some candidates. However it has to make sure that whne pruning out candidates it still preserves the GMEC. For it to be able to do this it needs to make some assumptions about the form of the energy function. 

For single state protein design the optimization problem is  : 
\[
S^* = \argmin_S E^*(S) = \argmin_S \left( \min_r E(r,S) \right)
\]

For multistate it is :
\[
S^* = \argmin_S E^*_1(S) + E^*_2(S) = \argmin_S\left( \min_r E_1(r,S) + \min_r E_2(r,S)\right)
\]

Multistate protein design tries to find the sequence that is stable under a number of different states. In their method yhey use the type-dependent DEE for pruning out the space of candidate solutions, while preserving the GMEC. Multistate optimization falls into two categories. First, wherein you are trying to design a structure that is stable in multiple state and second wherein you are trying to design for specificity which means that you are trying to design a sequence that is stable in one state but unstable in other states. The canonical way to represent the multistate optimization for specificity is :
\[
\begin{split}
Score(S) &= \alpha E_{pos}^*(S) - \beta E_{neg}^*(S) \quad \text{where } \alpha,\beta \geq 0 \\
S^* & = \argmin_S \left[\alpha \min_{\tau(r)=S} E_{pos}(r_{pos}) - \min_{\tau(r)=S} \beta E_{neg}(r_{neg})) \right]
\end{split} 
\]

Note that $E_{pos}^*(S)$ denote the minimal energy conformation for a particular sequence. I am confused isn't finding this exponentially hard as well ? Because we proved previously that the side chain optimization problem is NP hard. The way seqeunce design works with DEE is that the sequence space is expanded to include the rotameric space as well. So instead of doing DEE on a $20^N$ space you perform DEE over a $(20*n_{rot})^N$ space. Whatever the optimal rotamer assignments are, you can calculate the optimal sequence by just mapping the rotamer to the appropriate sequence. 
\\
\\
One strategy to do multistate design could be to combine the rotameric spaces of the two states and then optimize that energy function. Such as  : 
\[
\tilde{E_{ij}}(r_i,r_j) = \alpha E_{pos_{ij}}(r_i,r_j) - \beta E_{neg_{ij}}(r_i,r_j)
\]
However, this scheme assumes that the both states will have the same rotameric states. However, we want to do the minimization over the sequence space while letting the rotamers be different in each state. 



\section{Backbone Flexibility DEE}

\bibliographystyle{plain}
\bibliography{refs}


\end{document}